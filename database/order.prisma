enum PaymentType {
  STRIPE
  CRYPTO
  PAYPAL
}

enum OrderStatus {
  PENDING
  PAID
  DELIVERED
  CANCELLED
}

enum EmailSuppressionReason {
  HARD_BOUNCE
  COMPLAINT
  MANUAL_BLOCK
}

enum EmailSuppressionSource {
  RESEND_WEBHOOK
  ADMIN
}

enum EmailValidationStatus {
  VALID
  BLOCKED
}

model OrderItem {
  id String @id @default(cuid())

  orderId String
  order   Order  @relation(fields: [orderId], references: [id], onDelete: Cascade)

  productId String
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  quantity Int
  price    Float

  codes String[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model CustomerInformation {
  id      String  @id @default(cuid())
  name    String
  email   String
  emailValidationStatus EmailValidationStatus?
  emailValidationReason String?
  emailValidatedAt      DateTime?

  useragent String?
  ipAddress String?

  discord String?
  order   Order?

  affiliateId String?
  affiliate   Affiliate? @relation(fields: [affiliateId], references: [id], onDelete: SetNull)
}

model Order {
  id          String    @id @default(cuid())
  totalPrice  Float
  paymentFee  Float     @default(0)
  paymentType PaymentType
  status      OrderStatus
  couponUsed  String?
  discountAmount Float @default(0)

  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  paypalNote  String?
  notes       String[]  @default([])

  OrderItem   OrderItem[]

  customer   CustomerInformation @relation(fields: [customerId], references: [id], onDelete: Cascade)
  customerId String @unique

  Wallet Wallet[]
}

model SuppressedEmail {
  id     String @id @default(cuid())
  email  String @unique
  reason EmailSuppressionReason
  source EmailSuppressionSource

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model EmailDeliveryEvent {
  id                String @id @default(cuid())
  providerMessageId String?
  eventType         String
  recipient         String?
  payload           Json

  createdAt DateTime @default(now())

  @@unique([providerMessageId, eventType], map: "unique_provider_message_event")
}
